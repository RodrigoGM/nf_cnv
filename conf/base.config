// Base configuration for SC-CNV pipeline
params {
    // Input/Output paths (overridden by project config)
    seqdata = "${launchDir}/seqdata"
    outdir = "${launchDir}"
    sample_pattern = ".*"
    
    // Barcode file location
    barcode_file = "${launchDir}/nf_cnv/assets/barcode.192.txt"

    // Genome configuration
    genome = 'hsa38'
    
    // Genome indices
    genome_indices = [
        'hsa37': '/data1/singers/genomes/homo_sapiens/Ensembl/GRCh37.p13/Sequence/bwa_index/b37.fasta',
        'hsa38': '/data1/singers/genomes/homo_sapiens/Ensembl/GRCh38.p5/Sequence/BWAIndex/GRCh38.d1.vd1.fa',
        'pdx37': '/data1/singers/genomes/mus_musculus/mm10/Sequence/hg19_mm10_pdx/hg19_mm10.fa',
        'mm10': '/data1/singers/genomes/mus_musculus/mm10/Sequence/BWAIndex/GRCm38.p6.fa',
        'mm38': '/data1/singers/genomes/mus_musculus/mm10/Sequence/BWAIndex/GRCm38.p6.fa',
        'mm39': '/data1/singers/genomes/mus_musculus/mm39/Sequence/BWAIndex/mm39.fa'
    	]
    
    // Reference genome FASTA files for QC
    genome_fasta = [
        'hsa37': '/data1/singers/genomes/homo_sapiens/Ensembl/GRCh37.p13/Sequence/bwa_index/b37.fasta',
        'hsa38': '/data1/singers/genomes/homo_sapiens/Ensembl/GRCh38.p5/Sequence/BWAIndex/GRCh38.d1.vd1.fa',
        'pdx37': '/data1/singers/genomes/mus_musculus/mm10/Sequence/hg19_mm10_pdx/hg19_mm10.fa',
        'mm10': '/data1/singers/genomes/mus_musculus/mm10/Sequence/BWAIndex/GRCm38.p6.fa',
        'mm38': '/data1/singers/genomes/mus_musculus/mm10/Sequence/BWAIndex/GRCm38.p6.fa',
        'mm39': '/data1/singers/genomes/mus_musculus/mm39/Sequence/BWAIndex/mm39.fa'
    	]

    // Picard MarkDuplicates options
    no_optical_duplicates = false              // Set to true to disable optical duplicate detection
    optical_duplicate_pixel_distance = 2500   // Pixel distance for optical duplicates (when enabled)

    // Post-alignment options
    use_reverse_reads = false               // if true, clip r2 instead of r1

}

// Default process resource allocation
process {
    cpus = 1
    memory = '2 GB'
    time = '2h'
    
    // nf-core CAT_FASTQ module
    withName: CAT_FASTQ {
        cpus = 2
        memory = '8 GB'
        time = '4h'
    }
    
    // FASTQ verification processes
    withName: 'CHECK_FASTQ_PAIRS|CHECK_CELL_FASTQ_PAIRS' {
        cpus = 1
        memory = '4 GB'
        time = '1h'
    }
    
    // Barcode splitting (most resource intensive)
    withName: BARCODE_SPLIT {
        cpus = 2
        memory = '8 GB'
        time = '8h'
    }
    
    // Aggregation processes (lightweight)
    withName: 'AGGREGATE_*|CREATE_FASTQ_MANIFEST' {
        cpus = 1
        memory = '2 GB'
        time = '30m'
    }

    // Alignment process resources
    withName: BWA_MEM {
        cpus = 8
        memory = '32 GB'
        time = '8h'
    }
    
    withName: 'COLLATE_BAM|FIXMATE_BAM' {
        cpus = 2
        memory = '8 GB'
        time = '2h'
    }
    
    withName: SORT_BAM {
        cpus = 4
        memory = '16 GB'
        time = '4h'
    }
    
    withName: 'MARK_DUPLICATES|REMOVE_DUPLICATES' {
        cpus = 2
        memory = '16 GB'
        time = '4h'
    }
    
    withName: VALIDATE_BAM {
        cpus = 1
        memory = '4 GB'
        time = '30m'
    }

}


// Pipeline metadata
manifest {
    name = 'nf-cnv'
    description = 'Nextflow pipeline for single-cell copy number variation analysis'
    author = 'Rodrigo Gularte MÃ©rida'
    version = '1.0.0'
    mainScript = 'main.nf'
    nextflowVersion = '>=22.10.0'
}
